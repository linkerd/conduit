#!/bin/bash

set -eu

linkerd_namespace=$1

if [ -z "$linkerd_namespace" ]; then
    echo "usage: $(basename "$0") <namespace>" >&2
    exit 64
fi

echo "cleaning up namespace [${linkerd_namespace}] and associated test namespaces"

# `kubectl delete ns` will fail if there are no matching matching namespaces,
# causing this script to exit with an error status.
if ! namespaces=$(kubectl get ns | cut -f1 -d ' ' | grep -E "^$linkerd_namespace(-|$)"); then
  echo "no namespaces found for [$linkerd_namespace]" >&2
  exit 1
else
  kubectl delete ns $namespaces
fi
